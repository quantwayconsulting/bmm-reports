<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nifty 500 - Broad Market Monitor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <style>
        :root { --bg-color: #1a1b26; --card-bg-color: #24283b; --text-color: #c0caf5; --text-secondary-color: #a9b1d6; --border-color: #414868; --primary-color: #7aa2f7; --green: #9ece6a; --red: #f7768e; --blue: #7aa2f7; --cyan: #7dcfff; --yellow: #e0af68; --magenta: #bb9af7; }
        body[data-theme="bloomberg"] { --bg-color: #0d0d0d; --card-bg-color: #1a1a1a; --text-color: #e0e0e0; --text-secondary-color: #a0a0a0; --border-color: #333333; --primary-color: #ff9900; --green: #00e676; --red: #ff5252; --blue: #2979ff; --cyan: #00e5ff; --yellow: #ffd600; --magenta: #d500f9; }
        body[data-theme="light"] { --bg-color: #f5f7fa; --card-bg-color: #ffffff; --text-color: #1c2a42; --text-secondary-color: #5b6b85; --border-color: #e6e9f0; --primary-color: #0052cc; --green: #00875a; --red: #bf2600; --blue: #0052cc; --cyan: #00a3bf; --yellow: #ffab00; --magenta: #6554c0; }
        body { font-family: 'Segoe UI', 'Roboto', 'Helvetica', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 10px; }
        .container { max-width: 1600px; margin: auto; }
        header { text-align: center; margin-bottom: 25px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        h1 { font-size: 1.5rem; color: var(--text-color); margin: 0 0 5px 0; }
        h2 { margin: 0; color: var(--text-secondary-color); font-weight: 500; font-size: 1rem; }
        .card { background-color: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .chart-header { display: flex; flex-direction: column; align-items: flex-start; gap: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 15px; }
        .chart-title { font-size: 1.1rem; color: var(--text-secondary-color); font-weight: 500; }
        .zoom-hint { font-size: 0.8rem; font-style: italic; color: #6c707a; }
        .reset-zoom-btn { background: none; border: 1px solid var(--border-color); color: var(--text-secondary-color); padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        @media (min-width: 600px) { 
            h1 {font-size: 1.8rem;} h2 {font-size: 1.2rem;}
            .chart-header { flex-direction: row; justify-content: space-between; align-items: center;}
        }
    </style>
</head>
<body data-theme="bloomberg">
    <div class="container">
        <header>
            <h1>Nifty 500</h1>
            <h2>Timeframe: Weekly | Lookback: 104 Periods</h2>
        </header>
        <div id="charts">
            <div class="card chart-card"><div class="chart-header"><span class="chart-title">Market Trend (Sum)</span><div><span class="zoom-hint">Scroll/Drag to Zoom</span> <button class="reset-zoom-btn" data-chart-id="chart1">Reset</button></div></div><canvas id="chart1"></canvas></div>
            <div class="card chart-card"><div class="chart-header"><span class="chart-title">Market Proportion</span><div><span class="zoom-hint">Scroll/Drag to Zoom</span> <button class="reset-zoom-btn" data-chart-id="chart2">Reset</button></div></div><canvas id="chart2"></canvas></div>
            <div class="card chart-card"><div class="chart-header"><span class="chart-title">Market Breadth</span><div><span class="zoom-hint">Scroll/Drag to Zoom</span> <button class="reset-zoom-btn" data-chart-id="chart3">Reset</button></div></div><canvas id="chart3"></canvas></div>
        </div>
    </div>
    <script>
        window.chartData = {"labels": ["2023-10-10", "2023-10-17", "2023-10-25", "2023-11-01", "2023-11-08", "2023-11-15", "2023-11-22", "2023-11-30", "2023-12-07", "2023-12-14", "2023-12-21", "2023-12-29", "2024-01-05", "2024-01-12", "2024-01-19", "2024-01-29", "2024-02-05", "2024-02-12", "2024-02-19", "2024-02-26", "2024-03-02", "2024-03-11", "2024-03-18", "2024-03-26", "2024-04-03", "2024-04-10", "2024-04-19", "2024-04-26", "2024-05-06", "2024-05-13", "2024-05-18", "2024-05-27", "2024-06-03", "2024-06-10", "2024-06-18", "2024-06-25", "2024-07-02", "2024-07-09", "2024-07-16", "2024-07-24", "2024-07-31", "2024-08-07", "2024-08-14", "2024-08-22", "2024-08-29", "2024-09-05", "2024-09-12", "2024-09-19", "2024-09-26", "2024-10-04", "2024-10-11", "2024-10-18", "2024-10-25", "2024-11-01", "2024-11-08", "2024-11-18", "2024-11-26", "2024-12-03", "2024-12-10", "2024-12-17", "2024-12-24", "2025-01-01", "2025-01-08", "2025-01-15", "2025-01-22", "2025-01-29", "2025-02-04", "2025-02-11", "2025-02-18", "2025-02-25", "2025-03-05", "2025-03-12", "2025-03-20", "2025-03-27", "2025-04-04", "2025-04-15", "2025-04-23", "2025-04-30", "2025-05-08", "2025-05-15", "2025-05-22", "2025-05-29", "2025-06-05", "2025-06-12", "2025-06-19", "2025-06-26", "2025-07-03", "2025-07-10", "2025-07-17", "2025-07-24", "2025-07-31", "2025-08-07", "2025-08-14", "2025-08-22", "2025-09-01", "2025-09-08", "2025-09-15", "2025-09-22", "2025-09-29", "2025-10-07", "2025-10-14", "2025-10-21", "2025-10-29", "2025-11-06"], "chart1": {"trendOfStocks": [216, 271, -65, -34, 157, 195, 219, 299, 373, 361, 297, 355, 357, 331, 266, 204, 197, 149, 213, 191, 195, 56, -104, -4, 242, 264, 93, 238, 184, 45, 199, 158, 134, 238, 366, 294, 308, 330, 321, 225, 319, 100, -12, 194, 174, 194, 150, 97, 147, 11, 21, -19, -280, -127, -164, -302, -166, -7, 95, -13, -191, -101, -181, -363, -373, -379, -283, -379, -421, -380, -398, -378, -196, -78, -186, -36, 180, -4, -84, 258, 260, 256, 268, 276, 72, 280, 280, 260, 302, 182, -42, -140, -148, -52, -154, -92, 64, 86, -176, -16, -90, -4, 90, -74], "e9_trendOfStocks": [216.0, 227.0, 168.60000000000002, 128.08, 133.864, 146.09120000000001, 160.67296000000002, 188.33836800000003, 225.27069440000002, 252.41655552000003, 261.33324441600007, 280.0665955328001, 295.4532764262401, 302.5626211409921, 295.2500969127937, 277.000077530235, 261.00006202418797, 238.6000496193504, 233.48003969548031, 224.98403175638424, 218.9872254051074, 186.38978032408593, 128.31182425926875, 101.84945940741501, 129.87956752593203, 156.70365402074563, 143.96292321659652, 162.77033857327723, 167.0162708586218, 142.61301668689745, 153.89041334951798, 154.71233067961438, 150.56986454369152, 168.0558916349532, 207.6447133079626, 224.9157706463701, 241.5326165170961, 259.2260932136769, 271.58087457094155, 262.26469965675324, 273.6117597254026, 238.88940778032207, 188.71152622425765, 189.76922097940613, 186.6153767835249, 188.09230142681994, 180.47384114145595, 163.77907291316478, 160.42325833053184, 130.53860666442546, 108.63088533154037, 83.1047082652323, 10.483766612185846, -17.012986710251326, -46.410389368201066, -97.52831149456085, -111.22264919564869, -90.37811935651897, -53.302495485215175, -45.24199638817215, -74.39359711053771, -79.71487768843018, -99.97190215074414, -152.5775217205953, -196.66201737647629, -233.12961390118102, -243.10369112094483, -270.2829528967559, -300.4263623174047, -316.3410898539238, -332.67287188313907, -341.7382975065113, -312.59063800520903, -265.67251040416727, -249.73800832333382, -206.99040665866704, -129.59232532693363, -104.4738602615469, -100.37908820923752, -28.703270567390028, 29.037383546087977, 74.42990683687039, 113.14392546949631, 145.71514037559706, 130.97211230047765, 160.77768984038212, 184.6221518723057, 199.69772149784455, 220.15817719827567, 212.52654175862054, 161.62123340689644, 101.29698672551714, 51.43758938041372, 30.750071504330982, -6.199942796535215, -23.359954237228173, -5.887963389782538, 12.489629288173969, -25.208296569460828, -23.366637255568662, -36.69330980445493, -30.154647843563943, -6.123718274851157, -19.69897461988093]}, "chart2": {"proportion": [0.47161572052401746, 0.5904139433551199, -0.14161220043572983, -0.07391304347826087, 0.3405639913232104, 0.4229934924078091, 0.4750542299349241, 0.6457883369330454, 0.8056155507559395, 0.7796976241900648, 0.6387096774193548, 0.7634408602150538, 0.7677419354838709, 0.7118279569892473, 0.5708154506437768, 0.43776824034334766, 0.42184154175588867, 0.31905781584582443, 0.45610278372591007, 0.4089935760171306, 0.41755888650963596, 0.11965811965811966, -0.2222222222222222, -0.008547008547008548, 0.5148936170212766, 0.5617021276595745, 0.19745222929936307, 0.5042372881355932, 0.3898305084745763, 0.09513742071881606, 0.4189473684210526, 0.3319327731092437, 0.2815126050420168, 0.5, 0.7689075630252101, 0.6176470588235294, 0.6470588235294118, 0.6932773109243697, 0.6729559748427673, 0.4716981132075472, 0.6687631027253669, 0.20920502092050208, -0.025, 0.4041666666666667, 0.3625, 0.4024896265560166, 0.3112033195020747, 0.20082815734989648, 0.30434782608695654, 0.022774327122153208, 0.043478260869565216, -0.039337474120082816, -0.5785123966942148, -0.2618556701030928, -0.3374485596707819, -0.6163265306122448, -0.33877551020408164, -0.014256619144602852, 0.1934826883910387, -0.026476578411405296, -0.38585858585858585, -0.20404040404040405, -0.3656565656565657, -0.7333333333333333, -0.7535353535353535, -0.7656565656565657, -0.5717171717171717, -0.7656565656565657, -0.8505050505050505, -0.7661290322580645, -0.8024193548387096, -0.7620967741935484, -0.3951612903225806, -0.15725806451612903, -0.375, -0.07258064516129033, 0.3629032258064516, -0.008064516129032258, -0.1693548387096774, 0.5201612903225806, 0.5241935483870968, 0.5161290322580645, 0.5403225806451613, 0.5564516129032258, 0.14516129032258066, 0.5645161290322581, 0.5645161290322581, 0.5241935483870968, 0.6088709677419355, 0.36693548387096775, -0.0846774193548387, -0.28225806451612906, -0.29838709677419356, -0.10483870967741936, -0.31048387096774194, -0.18548387096774194, 0.12903225806451613, 0.17338709677419356, -0.3548387096774194, -0.03225806451612903, -0.1814516129032258, -0.008064516129032258, 0.1814516129032258, -0.14919354838709678], "e9_proportion": [0.47161572052401746, 0.49537536509023794, 0.3679778519850444, 0.27959967289238336, 0.29179253657854876, 0.31803272774440083, 0.3494370281825055, 0.4087072899326135, 0.48808894209727877, 0.546410678515836, 0.5648704782965398, 0.6045845546802426, 0.6372160308409683, 0.6521384160706242, 0.6358738229852547, 0.5962527064568733, 0.5613704735166765, 0.5129079419825061, 0.5015469103311869, 0.4830362434683757, 0.4699407720766278, 0.39988424159292624, 0.2754629488298966, 0.21866095735451557, 0.2779074892878678, 0.33466641696220917, 0.30722357942963996, 0.34662632117083064, 0.35526715863157976, 0.303241211049027, 0.3263824425234322, 0.3274925086405945, 0.318296527920879, 0.35463722233670325, 0.43749129047440466, 0.4735224441442296, 0.5082297200212661, 0.5452392382018869, 0.570782585530063, 0.5509656910655598, 0.5745251733975213, 0.5014611429021174, 0.39616891432169393, 0.3977684647906885, 0.3907147718325508, 0.393069742777244, 0.37669645812221014, 0.3415227979677474, 0.3340878035915893, 0.27182510829770207, 0.2261557388120747, 0.17305709622564322, 0.022743197641671598, -0.03417657590728128, -0.09483097265998142, -0.1991300842504341, -0.22705916944116364, -0.18449865938185148, -0.10890238982727343, -0.09241722754409981, -0.151105499206997, -0.16169248017367843, -0.20248529727025588, -0.30865490448287136, -0.3976309942933678, -0.4712361085660074, -0.4913323211962403, -0.5461971700883054, -0.6070587461716545, -0.6388728033889365, -0.6715821136788912, -0.6896850457818227, -0.6307802946899743, -0.5360758486552053, -0.5038606789241642, -0.4176046721715895, -0.2615030925759813, -0.21081537728659153, -0.20252326957120872, -0.057986357592450855, 0.05844962360345867, 0.14998550533437985, 0.22805292039653613, 0.2937326588978741, 0.2640183851828154, 0.32411793395270394, 0.3721975729686148, 0.4025967680523112, 0.4438516079902361, 0.42846838316638247, 0.3258392226621383, 0.20421976522648483, 0.10369839282634916, 0.06199097232559546, -0.012503996333072025, -0.047099971260006014, -0.01187352539510159, 0.025178599038757445, -0.05082486270447792, -0.04711150306680815, -0.07397952503409169, -0.060796523253079805, -0.012346896021818682, -0.0397162264948743]}, "chart3": {"abvEMA": [337, 365, 197, 213, 309, 328, 340, 381, 418, 412, 381, 410, 411, 398, 366, 335, 332, 308, 340, 329, 331, 262, 182, 232, 356, 367, 282, 355, 328, 259, 337, 317, 305, 357, 421, 385, 392, 403, 399, 351, 398, 289, 234, 337, 327, 338, 316, 290, 315, 247, 252, 232, 102, 179, 161, 94, 162, 242, 293, 239, 152, 197, 157, 66, 61, 58, 106, 58, 37, 58, 49, 59, 150, 209, 155, 230, 338, 246, 206, 377, 378, 376, 382, 386, 284, 388, 388, 378, 399, 339, 227, 178, 174, 222, 171, 202, 280, 291, 160, 240, 203, 246, 293, 211], "belEMA": [121, 94, 262, 247, 152, 133, 121, 82, 45, 51, 84, 55, 54, 67, 100, 131, 135, 159, 127, 138, 136, 206, 286, 236, 114, 103, 189, 117, 144, 214, 138, 159, 171, 119, 55, 91, 84, 73, 78, 126, 79, 189, 246, 143, 153, 144, 166, 193, 168, 236, 231, 251, 382, 306, 325, 396, 328, 249, 198, 252, 343, 298, 338, 429, 434, 437, 389, 437, 458, 438, 447, 437, 346, 287, 341, 266, 158, 250, 290, 119, 118, 120, 114, 110, 212, 108, 108, 118, 97, 157, 269, 318, 322, 274, 325, 294, 216, 205, 336, 256, 293, 250, 203, 285], "e9AbvEMA": [337.0, 342.6, 313.48, 293.384, 296.5072, 302.80576, 310.244608, 324.39568640000005, 343.11654912000006, 356.89323929600005, 361.71459143680005, 371.37167314944, 379.297338519552, 383.0378708156416, 379.63029665251327, 370.7042373220106, 362.9633898576085, 351.9707118860868, 349.57656950886945, 345.4612556070956, 342.5690044856765, 326.45520358854117, 297.56416287083294, 284.45133029666636, 298.7610642373331, 312.40885138986647, 306.3270811118932, 316.0616648895146, 318.4493319116117, 306.55946552928935, 312.6475724234315, 313.5180579387452, 311.81444635099615, 320.85155708079697, 340.88124566463756, 349.70499653171004, 358.163997225368, 367.1311977802944, 373.50495822423557, 369.0039665793885, 374.8031732635108, 357.6425386108087, 332.91403088864695, 333.73122471091756, 332.38497976873407, 333.5079838149873, 330.00638705198986, 322.0051096415919, 320.60408771327354, 305.88327017061886, 295.10661613649506, 282.48529290919606, 246.38823432735686, 232.9105874618855, 218.52846996950842, 193.62277597560677, 187.29822078048542, 198.23857662438834, 217.1908612995107, 221.55268903960857, 207.64215123168688, 205.51372098534952, 195.81097678827965, 169.84878143062372, 148.07902514449896, 130.06322011559917, 125.25057609247933, 111.80046087398347, 96.84036869918678, 89.07229495934942, 81.05783596747953, 76.64626877398362, 91.3170150191869, 114.85361201534951, 122.88288961227961, 144.3063116898237, 183.04504935185898, 195.63603948148722, 197.70883158518978, 233.56706526815185, 262.4536522145215, 285.1629217716172, 304.5303374172938, 320.82426993383507, 313.45941594706807, 328.3675327576545, 340.29402620612365, 347.83522096489895, 358.0681767719192, 354.2545414175354, 328.80363313402836, 298.64290650722273, 273.7143252057782, 263.3714601646226, 244.8971681316981, 236.3177345053585, 245.0541876042868, 254.24335008342945, 235.39468006674358, 236.31574405339487, 229.6525952427159, 232.92207619417275, 244.9376609553382, 238.15012876427056], "netStocks": [458, 459, 459, 460, 461, 461, 461, 463, 463, 463, 465, 465, 465, 465, 466, 466, 467, 467, 467, 467, 467, 468, 468, 468, 470, 470, 471, 472, 472, 473, 475, 476, 476, 476, 476, 476, 476, 476, 477, 477, 477, 478, 480, 480, 480, 482, 482, 483, 483, 483, 483, 483, 484, 485, 486, 490, 490, 491, 491, 491, 495, 495, 495, 495, 495, 495, 495, 495, 495, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496]}};
    </script>
    <script>
        
        (function() {
            const chartInstances = {};
            let isSyncing = false;

            document.querySelectorAll('.reset-zoom-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const chartId = e.target.getAttribute('data-chart-id');
                    if (chartInstances[chartId]) {
                        chartInstances[chartId].resetZoom();
                    }
                });
            });

            function syncCharts(sourceChart) {
                if (isSyncing) return;
                isSyncing = true;
                const { min, max } = sourceChart.scales.x;
                for (const chartId in chartInstances) {
                    const targetChart = chartInstances[chartId];
                    if (targetChart.canvas.id !== sourceChart.canvas.id) {
                        targetChart.options.scales.x.min = min;
                        targetChart.options.scales.x.max = max;
                        targetChart.update('none');
                    }
                }
                isSyncing = false;
            }

            function createCharts(data) {
                const computedStyles = getComputedStyle(document.body);
                const colors = {
                    green: computedStyles.getPropertyValue('--green').trim(), red: computedStyles.getPropertyValue('--red').trim(),
                    blue: computedStyles.getPropertyValue('--blue').trim(), cyan: computedStyles.getPropertyValue('--cyan').trim(),
                    yellow: computedStyles.getPropertyValue('--yellow').trim(), magenta: computedStyles.getPropertyValue('--magenta').trim(),
                    text: computedStyles.getPropertyValue('--text-color').trim(), grid: computedStyles.getPropertyValue('--border-color').trim() + '80',
                };
                const commonOptions = {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        x: { grid: { color: colors.grid }, ticks: { color: colors.text, maxRotation: 0, autoSkip: true, maxTicksLimit: 15 }, grace: '5%' },
                        y: { grid: { color: colors.grid }, ticks: { color: colors.text } }
                    },
                    plugins: {
                        legend: { labels: { color: colors.text, font: { size: 14 } } },
                        tooltip: {
                            backgroundColor: computedStyles.getPropertyValue('--card-bg-color').trim(),
                            titleFont: { size: 16 }, bodyFont: { size: 14 }, padding: 10,
                            borderColor: colors.grid, borderWidth: 1, titleColor: colors.text, bodyColor: colors.text,
                        },
                        zoom: {
                            pan: { enabled: true, mode: 'x', onPanComplete: ({ chart }) => syncCharts(chart) },
                            zoom: {
                                drag: { enabled: false },
                                wheel: { enabled: true }, 
                                pinch: { enabled: true },
                                mode: 'x',
                                onZoomComplete: ({ chart }) => syncCharts(chart)
                            }
                        }
                    },
                    elements: { point: { radius: 0 } },
                    interaction: { intersect: false, mode: 'index' }
                };
                const chartHeight = 450;
                document.querySelectorAll('.chart-card canvas').forEach(c => c.parentElement.style.height = chartHeight + 'px');
                
                chartInstances.chart1 = new Chart(document.getElementById('chart1'), { type: 'line', data: { labels: data.labels, datasets: [{ label: 'Trend Of Stks', data: data.chart1.trendOfStocks, borderColor: colors.magenta, borderWidth: 2, tension: 0.1 }, { label: 'e9 (EMA)', data: data.chart1.e9_trendOfStocks, borderColor: colors.blue, borderWidth: 2, tension: 0.1 }] }, options: commonOptions });
                chartInstances.chart2 = new Chart(document.getElementById('chart2'), { type: 'line', data: { labels: data.labels, datasets: [{ label: 'Proportion', data: data.chart2.proportion, borderColor: colors.yellow, borderWidth: 2, tension: 0.1 }, { label: 'e9 (EMA)', data: data.chart2.e9_proportion, borderColor: colors.blue, borderWidth: 2, tension: 0.1 }] }, options: commonOptions });
                chartInstances.chart3 = new Chart(document.getElementById('chart3'), { type: 'line', data: { labels: data.labels, datasets: [{ label: 'Stocks Above EMA', data: data.chart3.abvEMA, borderColor: colors.green, borderWidth: 2, tension: 0.1 }, { label: 'Stocks Below EMA', data: data.chart3.belEMA, borderColor: colors.red, borderWidth: 2, tension: 0.1 }, { label: 'Net Stocks', data: data.chart3.netStocks, borderColor: colors.text, borderWidth: 1, tension: 0.1, borderDash: [5, 5] }] }, options: commonOptions });
            }
            createCharts(window.chartData);
        })();
    
    </script>
</body>
</html>