<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nifty 500 - Broad Market Monitor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <style>
        :root { --bg-color: #1a1b26; --card-bg-color: #24283b; --text-color: #c0caf5; --text-secondary-color: #a9b1d6; --border-color: #414868; --primary-color: #7aa2f7; --green: #9ece6a; --red: #f7768e; --blue: #7aa2f7; --cyan: #7dcfff; --yellow: #e0af68; --magenta: #bb9af7; }
        body[data-theme="bloomberg"] { --bg-color: #0d0d0d; --card-bg-color: #1a1a1a; --text-color: #e0e0e0; --text-secondary-color: #a0a0a0; --border-color: #333333; --primary-color: #ff9900; --green: #00e676; --red: #ff5252; --blue: #2979ff; --cyan: #00e5ff; --yellow: #ffd600; --magenta: #d500f9; }
        body[data-theme="light"] { --bg-color: #f5f7fa; --card-bg-color: #ffffff; --text-color: #1c2a42; --text-secondary-color: #5b6b85; --border-color: #e6e9f0; --primary-color: #0052cc; --green: #00875a; --red: #bf2600; --blue: #0052cc; --cyan: #00a3bf; --yellow: #ffab00; --magenta: #6554c0; }
        body { font-family: 'Segoe UI', 'Roboto', 'Helvetica', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 10px; }
        .container { max-width: 1600px; margin: auto; }
        header { text-align: center; margin-bottom: 25px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        h1 { font-size: 1.5rem; color: var(--text-color); margin: 0 0 5px 0; }
        h2 { margin: 0; color: var(--text-secondary-color); font-weight: 500; font-size: 1rem; }
        .card { background-color: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .chart-header { display: flex; flex-direction: column; align-items: flex-start; gap: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 15px; }
        .chart-title { font-size: 1.1rem; color: var(--text-secondary-color); font-weight: 500; }
        .zoom-hint { font-size: 0.8rem; font-style: italic; color: #6c707a; }
        .reset-zoom-btn { background: none; border: 1px solid var(--border-color); color: var(--text-secondary-color); padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        @media (min-width: 600px) { 
            h1 {font-size: 1.8rem;} h2 {font-size: 1.2rem;}
            .chart-header { flex-direction: row; justify-content: space-between; align-items: center;}
        }
    </style>
</head>
<body data-theme="bloomberg">
    <div class="container">
        <header>
            <h1>Nifty 500</h1>
            <h2>Timeframe: Weekly | Lookback: 104 Periods</h2>
        </header>
        <div id="charts">
            <div class="card chart-card"><div class="chart-header"><span class="chart-title">Market Trend (Sum)</span><div><span class="zoom-hint">Scroll/Drag to Zoom</span> <button class="reset-zoom-btn" data-chart-id="chart1">Reset</button></div></div><canvas id="chart1"></canvas></div>
            <div class="card chart-card"><div class="chart-header"><span class="chart-title">Market Proportion</span><div><span class="zoom-hint">Scroll/Drag to Zoom</span> <button class="reset-zoom-btn" data-chart-id="chart2">Reset</button></div></div><canvas id="chart2"></canvas></div>
            <div class="card chart-card"><div class="chart-header"><span class="chart-title">Market Breadth</span><div><span class="zoom-hint">Scroll/Drag to Zoom</span> <button class="reset-zoom-btn" data-chart-id="chart3">Reset</button></div></div><canvas id="chart3"></canvas></div>
        </div>
    </div>
    <script>
        window.chartData = {"labels": ["2023-12-13", "2023-12-20", "2023-12-28", "2024-01-04", "2024-01-11", "2024-01-18", "2024-01-25", "2024-02-02", "2024-02-09", "2024-02-16", "2024-02-23", "2024-03-01", "2024-03-07", "2024-03-15", "2024-03-22", "2024-04-02", "2024-04-09", "2024-04-18", "2024-04-25", "2024-05-03", "2024-05-10", "2024-05-17", "2024-05-24", "2024-05-31", "2024-06-07", "2024-06-14", "2024-06-24", "2024-07-01", "2024-07-08", "2024-07-15", "2024-07-23", "2024-07-30", "2024-08-06", "2024-08-13", "2024-08-21", "2024-08-28", "2024-09-04", "2024-09-11", "2024-09-18", "2024-09-25", "2024-10-03", "2024-10-10", "2024-10-17", "2024-10-24", "2024-10-31", "2024-11-07", "2024-11-14", "2024-11-25", "2024-12-02", "2024-12-09", "2024-12-16", "2024-12-23", "2024-12-31", "2025-01-07", "2025-01-14", "2025-01-21", "2025-01-28", "2025-02-03", "2025-02-10", "2025-02-17", "2025-02-24", "2025-03-04", "2025-03-11", "2025-03-19", "2025-03-26", "2025-04-03", "2025-04-11", "2025-04-22", "2025-04-29", "2025-05-07", "2025-05-14", "2025-05-21", "2025-05-28", "2025-06-04", "2025-06-11", "2025-06-18", "2025-06-25", "2025-07-02", "2025-07-09", "2025-07-16", "2025-07-23", "2025-07-30", "2025-08-06", "2025-08-13", "2025-08-21", "2025-08-29", "2025-09-05", "2025-09-12", "2025-09-19", "2025-09-26", "2025-10-06", "2025-10-13", "2025-10-20", "2025-10-28", "2025-11-04", "2025-11-12", "2025-11-19", "2025-11-26", "2025-12-03", "2025-12-10", "2025-12-17", "2025-12-24", "2026-01-01", "2026-01-08"], "chart1": {"trendOfStocks": [369, 290, 355, 377, 351, 266, 224, 266, 211, 211, 221, 175, 106, -96, -38, 210, 238, 115, 238, 224, 54, 187, 188, 62, 242, 374, 332, 342, 318, 339, 213, 341, 36, 66, 204, 228, 225, 130, 151, 189, 95, 29, 1, -216, -149, -118, -290, -156, -51, 109, 69, -175, -137, -123, -359, -327, -405, -307, -295, -413, -396, -414, -362, -212, -110, -6, -162, 190, 76, 12, 224, 310, 276, 274, 360, 168, 252, 276, 270, 300, 200, 0, -134, -142, -16, -218, -92, 30, 164, -160, -8, -8, -8, 44, 2, -20, -58, -80, -158, -228, -190, -70, -72, -108], "e9_trendOfStocks": [369.0, 353.2, 353.56, 358.24800000000005, 356.7984, 338.63872000000003, 315.7109760000001, 305.76878080000006, 286.81502464000005, 271.652019712, 261.52161576960003, 244.21729261568004, 216.57383409254402, 154.05906727403521, 115.64725381922818, 134.51780305538256, 155.21424244430605, 147.17139395544484, 165.33711516435588, 177.06969213148471, 152.4557537051878, 159.36460296415024, 165.0916823713202, 144.47334589705616, 163.97867671764493, 205.98294137411597, 231.1863530992928, 253.34908247943426, 266.2792659835474, 280.82341278683793, 267.25873022947036, 282.0069841835763, 232.80558734686105, 199.44446987748884, 200.3555759019911, 205.8844607215929, 209.70756857727432, 193.76605486181947, 185.2128438894556, 185.9702751115645, 167.7762200892516, 140.0209760714013, 112.21678085712104, 46.573424685696835, 7.458739748557466, -17.633008201154027, -72.10640656092322, -88.88512524873858, -81.30810019899087, -43.2464801591927, -20.79718412735416, -51.63774730188333, -68.71019784150667, -79.56815827320534, -135.45452661856427, -173.76362129485142, -220.01089703588113, -237.40871762870492, -248.92697410296395, -281.74157928237116, -304.59326342589696, -326.4746107407176, -333.57968859257414, -309.2637508740594, -269.41100069924755, -216.72880055939805, -205.78304044751846, -126.62643235801477, -86.10114588641181, -66.48091670912945, -8.384733367303554, 55.29221330615716, 99.43377064492573, 134.3470165159406, 179.4776132127525, 177.18209057020198, 192.1456724561616, 208.91653796492932, 221.13323037194345, 236.9065842975548, 229.52526743804384, 183.62021395043507, 120.09617116034808, 67.67693692827847, 50.941549542622774, -2.8467603659017797, -20.677408292721427, -10.541926634177141, 24.36645869265829, -12.506833045873364, -11.605466436698691, -10.884373149358954, -10.307498519487163, 0.5540011844102697, 0.8432009475282158, -3.3254392419774272, -14.260351393581944, -27.408281114865556, -53.526624891892446, -88.42129991351396, -108.73703993081118, -100.98963194464895, -95.19170555571917, -97.75336444457534]}, "chart2": {"proportion": [0.796976241900648, 0.625, 0.7634408602150538, 0.810752688172043, 0.7548387096774194, 0.5708154506437768, 0.48068669527896996, 0.5708154506437768, 0.4518201284796574, 0.4518201284796574, 0.4732334047109208, 0.3747323340471092, 0.2264957264957265, -0.20512820512820512, -0.0811965811965812, 0.44680851063829785, 0.5063829787234042, 0.24416135881104034, 0.5042372881355932, 0.4745762711864407, 0.11440677966101695, 0.3936842105263158, 0.3949579831932773, 0.13025210084033614, 0.5084033613445378, 0.7857142857142857, 0.6974789915966386, 0.7184873949579832, 0.6680672268907563, 0.710691823899371, 0.44654088050314467, 0.7148846960167715, 0.07531380753138076, 0.1375, 0.425, 0.475, 0.4677754677754678, 0.2697095435684647, 0.31262939958592134, 0.391304347826087, 0.19668737060041408, 0.060041407867494824, 0.002070393374741201, -0.4462809917355372, -0.30721649484536084, -0.24279835390946503, -0.5918367346938775, -0.3183673469387755, -0.10386965376782077, 0.2219959266802444, 0.14052953156822812, -0.35353535353535354, -0.2767676767676768, -0.24848484848484848, -0.7252525252525253, -0.6606060606060606, -0.8181818181818182, -0.6202020202020202, -0.5959595959595959, -0.8343434343434344, -0.7983870967741935, -0.8346774193548387, -0.7298387096774194, -0.4274193548387097, -0.2217741935483871, -0.012096774193548387, -0.32661290322580644, 0.38306451612903225, 0.1532258064516129, 0.024193548387096774, 0.45161290322580644, 0.625, 0.5564516129032258, 0.5524193548387096, 0.7258064516129032, 0.3387096774193548, 0.5080645161290323, 0.5564516129032258, 0.5443548387096774, 0.6048387096774194, 0.4032258064516129, 0.0, -0.2701612903225806, -0.2862903225806452, -0.03225806451612903, -0.43951612903225806, -0.18548387096774194, 0.06048387096774194, 0.33064516129032256, -0.3225806451612903, -0.016129032258064516, -0.016129032258064516, -0.016129032258064516, 0.08870967741935484, 0.004032258064516129, -0.04032258064516129, -0.11693548387096774, -0.16129032258064516, -0.3185483870967742, -0.4596774193548387, -0.38306451612903225, -0.14112903225806453, -0.14516129032258066, -0.21774193548387097], "e9_proportion": [0.796976241900648, 0.7625809935205184, 0.7627529668594256, 0.7723529111219491, 0.7688500708330432, 0.72924314679519, 0.679531856491946, 0.6577885753223122, 0.6165948859537812, 0.5836399344589565, 0.5615586285093493, 0.5241933696169013, 0.4646538409926664, 0.3306974317684921, 0.24831862917547742, 0.28801660546804153, 0.33168988011911404, 0.3141841758574993, 0.3521947983131181, 0.37667109288778267, 0.3242182302424296, 0.3381114262992068, 0.3494807376780209, 0.30563501031048396, 0.34618868051729473, 0.4340938015566929, 0.4867708395646821, 0.5331141506433423, 0.5601047658928251, 0.5902221774941343, 0.5614859180959364, 0.5921656736801034, 0.4887953004503589, 0.4185362403602872, 0.4198289922882298, 0.4308631938305838, 0.4382456486195606, 0.40453842760934144, 0.38615662200465745, 0.3871861671689434, 0.34908640785523753, 0.291277407857689, 0.23343600496109948, 0.09749260562177216, 0.016550785528345567, -0.035319042359216554, -0.14662258082614876, -0.1809715340486741, -0.16555115799250344, -0.08804174105795387, -0.04232748653271748, -0.1045690599332447, -0.1390087833001311, -0.16090399633707458, -0.2737737021201647, -0.3511401738173439, -0.4445485026902388, -0.47967920619259513, -0.5029352841459953, -0.5692169141854831, -0.6150509507032252, -0.658976244433548, -0.6731487374823223, -0.6240028609535998, -0.5435571274725572, -0.43726505681675554, -0.4151346260985657, -0.25549479765304617, -0.17375067683211437, -0.13416183178827212, -0.017006884785456408, 0.11139449217163487, 0.20040591631795307, 0.2708086040221044, 0.3618081735402642, 0.3571884743160823, 0.3873636826786723, 0.421181268723583, 0.4458159827208019, 0.4776205281121254, 0.4627415837800229, 0.37019326702401834, 0.24212235555469858, 0.13643981992762982, 0.10270024303887805, -0.005743031375349164, -0.041691199293827724, -0.021256185241513792, 0.04912408406485348, -0.02521686178037527, -0.023399295875913124, -0.021945243152343405, -0.02078200097348763, 0.0011163347050808653, 0.001699519376967918, -0.006704900627457923, -0.028751017276159887, -0.05525887833705694, -0.1079167800890004, -0.17826890794216804, -0.2192280295795409, -0.20360823011524565, -0.19191884215671268, -0.19708346082214434]}, "chart3": {"abvEMA": [416, 377, 410, 421, 408, 366, 345, 366, 339, 339, 344, 321, 287, 186, 215, 340, 354, 293, 355, 348, 263, 331, 332, 269, 359, 425, 404, 409, 397, 408, 345, 409, 257, 273, 342, 354, 353, 306, 317, 336, 289, 256, 242, 134, 168, 184, 100, 167, 220, 300, 280, 160, 179, 186, 68, 84, 45, 94, 100, 41, 50, 41, 67, 142, 193, 245, 167, 343, 286, 254, 360, 403, 386, 385, 428, 332, 374, 386, 383, 398, 348, 248, 181, 177, 240, 139, 202, 263, 330, 168, 244, 244, 244, 270, 249, 238, 219, 208, 169, 134, 153, 213, 212, 194], "belEMA": [47, 87, 55, 44, 57, 100, 121, 100, 128, 128, 123, 146, 181, 282, 253, 130, 116, 178, 117, 124, 209, 144, 144, 207, 117, 51, 72, 67, 79, 69, 132, 68, 221, 207, 138, 126, 128, 176, 166, 147, 194, 227, 241, 350, 317, 302, 390, 323, 271, 191, 211, 335, 316, 309, 427, 411, 450, 401, 395, 454, 446, 455, 429, 354, 303, 251, 329, 153, 210, 242, 136, 93, 110, 111, 68, 164, 122, 110, 113, 98, 148, 248, 315, 319, 256, 357, 294, 233, 166, 328, 252, 252, 252, 226, 247, 258, 277, 288, 327, 362, 343, 283, 284, 302], "e9AbvEMA": [416.0, 408.20000000000005, 408.56000000000006, 411.04800000000006, 410.4384000000001, 401.5507200000001, 390.24057600000015, 385.39246080000015, 376.11396864000017, 368.6911749120002, 363.7529399296002, 355.2023519436801, 341.5618815549441, 310.4495052439553, 291.35960419516425, 301.0876833561314, 311.6701466849051, 307.9361173479241, 317.34889387833925, 323.4791151026714, 311.3832920821372, 315.30663366570974, 318.6453069325678, 308.71624554605427, 318.7729964368434, 340.0183971494747, 352.8147177195798, 364.05177417566387, 370.6414193405311, 378.1131354724249, 371.49050837793993, 378.99240670235196, 354.5939253618816, 338.2751402895053, 339.02011223160423, 342.0160897852834, 344.21287182822675, 336.5702974625814, 332.65623797006515, 333.32499037605214, 324.45999230084175, 310.7679938406734, 297.0143950725387, 264.411516058031, 245.1292128464248, 232.90337027713986, 206.3226962217119, 198.45815697736955, 202.76652558189565, 222.21322046551654, 233.77057637241325, 219.0164610979306, 211.01316887834452, 206.01053510267565, 178.40842808214052, 159.52674246571243, 136.62139397256993, 128.09711517805596, 122.47769214244477, 106.18215371395583, 94.94572297116467, 84.15657837693175, 80.7252627015454, 92.98021016123633, 112.98416812898907, 139.38733450319125, 144.90986760255302, 184.52789408204245, 204.82231526563396, 214.65785221250718, 243.72628177000576, 275.58102541600465, 297.66482033280374, 315.131856266243, 337.7054850129944, 336.56438801039553, 344.05151040831646, 352.44120832665317, 358.55296666132256, 366.44237332905806, 362.7538986632465, 339.80311893059724, 308.0424951444778, 281.83399611558224, 273.46719689246584, 246.57375751397268, 237.65900601117815, 242.72720480894253, 260.181763847154, 241.74541107772322, 242.1963288621786, 242.5570630897429, 242.84565047179436, 248.2765203774355, 248.42121630194842, 246.33697304155874, 240.869578433247, 234.2956627465976, 221.2365301972781, 203.7892241578225, 193.631379326258, 197.50510346100643, 200.40408276880515, 199.12326621504414], "netStocks": [463, 464, 465, 465, 465, 466, 466, 466, 467, 467, 467, 467, 468, 468, 468, 470, 470, 471, 472, 472, 472, 475, 476, 476, 476, 476, 476, 476, 476, 477, 477, 477, 478, 480, 480, 480, 481, 482, 483, 483, 483, 483, 483, 484, 485, 486, 490, 490, 491, 491, 491, 495, 495, 495, 495, 495, 495, 495, 495, 495, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496]}};
    </script>
    <script>
        
        (function() {
            const chartInstances = {};
            let isSyncing = false;

            document.querySelectorAll('.reset-zoom-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const chartId = e.target.getAttribute('data-chart-id');
                    if (chartInstances[chartId]) {
                        chartInstances[chartId].resetZoom();
                    }
                });
            });

            function syncCharts(sourceChart) {
                if (isSyncing) return;
                isSyncing = true;
                const { min, max } = sourceChart.scales.x;
                for (const chartId in chartInstances) {
                    const targetChart = chartInstances[chartId];
                    if (targetChart.canvas.id !== sourceChart.canvas.id) {
                        targetChart.options.scales.x.min = min;
                        targetChart.options.scales.x.max = max;
                        targetChart.update('none');
                    }
                }
                isSyncing = false;
            }

            function createCharts(data) {
                const computedStyles = getComputedStyle(document.body);
                const colors = {
                    green: computedStyles.getPropertyValue('--green').trim(), red: computedStyles.getPropertyValue('--red').trim(),
                    blue: computedStyles.getPropertyValue('--blue').trim(), cyan: computedStyles.getPropertyValue('--cyan').trim(),
                    yellow: computedStyles.getPropertyValue('--yellow').trim(), magenta: computedStyles.getPropertyValue('--magenta').trim(),
                    text: computedStyles.getPropertyValue('--text-color').trim(), grid: computedStyles.getPropertyValue('--border-color').trim() + '80',
                };
                const commonOptions = {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        x: { grid: { color: colors.grid }, ticks: { color: colors.text, maxRotation: 0, autoSkip: true, maxTicksLimit: 15 }, grace: '5%' },
                        y: { grid: { color: colors.grid }, ticks: { color: colors.text } }
                    },
                    plugins: {
                        legend: { labels: { color: colors.text, font: { size: 14 } } },
                        tooltip: {
                            backgroundColor: computedStyles.getPropertyValue('--card-bg-color').trim(),
                            titleFont: { size: 16 }, bodyFont: { size: 14 }, padding: 10,
                            borderColor: colors.grid, borderWidth: 1, titleColor: colors.text, bodyColor: colors.text,
                        },
                        zoom: {
                            pan: { enabled: true, mode: 'x', onPanComplete: ({ chart }) => syncCharts(chart) },
                            zoom: {
                                drag: { enabled: false },
                                wheel: { enabled: true }, 
                                pinch: { enabled: true },
                                mode: 'x',
                                onZoomComplete: ({ chart }) => syncCharts(chart)
                            }
                        }
                    },
                    elements: { point: { radius: 0 } },
                    interaction: { intersect: false, mode: 'index' }
                };
                const chartHeight = 450;
                document.querySelectorAll('.chart-card canvas').forEach(c => c.parentElement.style.height = chartHeight + 'px');
                
                chartInstances.chart1 = new Chart(document.getElementById('chart1'), { type: 'line', data: { labels: data.labels, datasets: [{ label: 'Trend Of Stks', data: data.chart1.trendOfStocks, borderColor: colors.magenta, borderWidth: 2, tension: 0.1 }, { label: 'e9 (EMA)', data: data.chart1.e9_trendOfStocks, borderColor: colors.blue, borderWidth: 2, tension: 0.1 }] }, options: commonOptions });
                chartInstances.chart2 = new Chart(document.getElementById('chart2'), { type: 'line', data: { labels: data.labels, datasets: [{ label: 'Proportion', data: data.chart2.proportion, borderColor: colors.yellow, borderWidth: 2, tension: 0.1 }, { label: 'e9 (EMA)', data: data.chart2.e9_proportion, borderColor: colors.blue, borderWidth: 2, tension: 0.1 }] }, options: commonOptions });
                chartInstances.chart3 = new Chart(document.getElementById('chart3'), { type: 'line', data: { labels: data.labels, datasets: [{ label: 'Stocks Above EMA', data: data.chart3.abvEMA, borderColor: colors.green, borderWidth: 2, tension: 0.1 }, { label: 'Stocks Below EMA', data: data.chart3.belEMA, borderColor: colors.red, borderWidth: 2, tension: 0.1 }, { label: 'Net Stocks', data: data.chart3.netStocks, borderColor: colors.text, borderWidth: 1, tension: 0.1, borderDash: [5, 5] }] }, options: commonOptions });
            }
            createCharts(window.chartData);
        })();
    
    </script>
</body>
</html>