<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nifty 500 - Broad Market Monitor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <style>
        :root { --bg-color: #1a1b26; --card-bg-color: #24283b; --text-color: #c0caf5; --text-secondary-color: #a9b1d6; --border-color: #414868; --primary-color: #7aa2f7; --green: #9ece6a; --red: #f7768e; --blue: #7aa2f7; --cyan: #7dcfff; --yellow: #e0af68; --magenta: #bb9af7; }
        body[data-theme="bloomberg"] { --bg-color: #0d0d0d; --card-bg-color: #1a1a1a; --text-color: #e0e0e0; --text-secondary-color: #a0a0a0; --border-color: #333333; --primary-color: #ff9900; --green: #00e676; --red: #ff5252; --blue: #2979ff; --cyan: #00e5ff; --yellow: #ffd600; --magenta: #d500f9; }
        body[data-theme="light"] { --bg-color: #f5f7fa; --card-bg-color: #ffffff; --text-color: #1c2a42; --text-secondary-color: #5b6b85; --border-color: #e6e9f0; --primary-color: #0052cc; --green: #00875a; --red: #bf2600; --blue: #0052cc; --cyan: #00a3bf; --yellow: #ffab00; --magenta: #6554c0; }
        body { font-family: 'Segoe UI', 'Roboto', 'Helvetica', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 10px; }
        .container { max-width: 1600px; margin: auto; }
        header { text-align: center; margin-bottom: 25px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        h1 { font-size: 1.5rem; color: var(--text-color); margin: 0 0 5px 0; }
        h2 { margin: 0; color: var(--text-secondary-color); font-weight: 500; font-size: 1rem; }
        .card { background-color: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .chart-header { display: flex; flex-direction: column; align-items: flex-start; gap: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 15px; }
        .chart-title { font-size: 1.1rem; color: var(--text-secondary-color); font-weight: 500; }
        .zoom-hint { font-size: 0.8rem; font-style: italic; color: #6c707a; }
        .reset-zoom-btn { background: none; border: 1px solid var(--border-color); color: var(--text-secondary-color); padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        @media (min-width: 600px) { 
            h1 {font-size: 1.8rem;} h2 {font-size: 1.2rem;}
            .chart-header { flex-direction: row; justify-content: space-between; align-items: center;}
        }
    </style>
</head>
<body data-theme="bloomberg">
    <div class="container">
        <header>
            <h1>Nifty 500</h1>
            <h2>Timeframe: Weekly | Lookback: 104 Periods</h2>
        </header>
        <div id="charts">
            <div class="card chart-card"><div class="chart-header"><span class="chart-title">Market Trend (Sum)</span><div><span class="zoom-hint">Scroll/Drag to Zoom</span> <button class="reset-zoom-btn" data-chart-id="chart1">Reset</button></div></div><canvas id="chart1"></canvas></div>
            <div class="card chart-card"><div class="chart-header"><span class="chart-title">Market Proportion</span><div><span class="zoom-hint">Scroll/Drag to Zoom</span> <button class="reset-zoom-btn" data-chart-id="chart2">Reset</button></div></div><canvas id="chart2"></canvas></div>
            <div class="card chart-card"><div class="chart-header"><span class="chart-title">Market Breadth</span><div><span class="zoom-hint">Scroll/Drag to Zoom</span> <button class="reset-zoom-btn" data-chart-id="chart3">Reset</button></div></div><canvas id="chart3"></canvas></div>
        </div>
    </div>
    <script>
        window.chartData = {"labels": ["2023-10-11", "2023-10-18", "2023-10-26", "2023-11-02", "2023-11-09", "2023-11-16", "2023-11-23", "2023-12-01", "2023-12-08", "2023-12-15", "2023-12-22", "2024-01-01", "2024-01-08", "2024-01-15", "2024-01-20", "2024-01-30", "2024-02-06", "2024-02-13", "2024-02-20", "2024-02-27", "2024-03-04", "2024-03-12", "2024-03-19", "2024-03-27", "2024-04-04", "2024-04-12", "2024-04-22", "2024-04-29", "2024-05-07", "2024-05-14", "2024-05-21", "2024-05-28", "2024-06-04", "2024-06-11", "2024-06-19", "2024-06-26", "2024-07-03", "2024-07-10", "2024-07-18", "2024-07-25", "2024-08-01", "2024-08-08", "2024-08-16", "2024-08-23", "2024-08-30", "2024-09-06", "2024-09-13", "2024-09-20", "2024-09-27", "2024-10-07", "2024-10-14", "2024-10-21", "2024-10-28", "2024-11-04", "2024-11-11", "2024-11-19", "2024-11-27", "2024-12-04", "2024-12-11", "2024-12-18", "2024-12-26", "2025-01-02", "2025-01-09", "2025-01-16", "2025-01-23", "2025-01-30", "2025-02-05", "2025-02-12", "2025-02-19", "2025-02-27", "2025-03-06", "2025-03-13", "2025-03-21", "2025-03-28", "2025-04-07", "2025-04-16", "2025-04-24", "2025-05-02", "2025-05-09", "2025-05-16", "2025-05-23", "2025-05-30", "2025-06-06", "2025-06-13", "2025-06-20", "2025-06-27", "2025-07-04", "2025-07-11", "2025-07-18", "2025-07-25", "2025-08-01", "2025-08-08", "2025-08-18", "2025-08-25", "2025-09-02", "2025-09-09", "2025-09-16", "2025-09-23", "2025-09-30", "2025-10-08", "2025-10-15", "2025-10-23", "2025-10-30", "2025-11-07"], "chart1": {"trendOfStocks": [247, 221, -119, 18, 139, 225, 227, 321, 357, 367, 317, 363, 341, 325, 268, 214, 235, 151, 213, 193, 177, -4, -142, 22, 248, 221, 143, 256, 122, 125, 181, 144, -136, 338, 368, 342, 356, 317, 319, 243, 327, 96, 100, 182, 198, 130, 190, 129, 159, -101, 23, -95, -239, -174, -162, -280, -127, 37, 125, -49, -181, -59, -231, -321, -329, -383, -257, -395, -411, -414, -384, -390, -124, -106, -324, 24, 184, -24, -90, 318, 302, 258, 288, 226, 112, 284, 288, 222, 238, 30, -110, -174, -66, -26, -106, -74, 122, 60, -170, -76, -46, 26, 68, -76], "e9_trendOfStocks": [247.0, 241.8, 169.64000000000001, 139.312, 139.24960000000002, 156.39968000000002, 170.51974400000003, 200.61579520000004, 231.89263616000005, 258.914108928, 270.53128714240006, 289.02502971392005, 299.4200237711361, 304.5360190169089, 297.2288152135271, 280.5830521708217, 271.4664417366574, 247.37315338932592, 240.49852271146074, 230.9988181691686, 220.1990545353349, 175.35924362826793, 111.88739490261435, 93.90991592209149, 124.7279327376732, 143.98234619013857, 143.78587695211087, 166.2287015616887, 157.38296124935096, 150.90636899948078, 156.92509519958463, 154.34007615966772, 96.27206092773417, 144.61764874218736, 189.29411899374992, 219.83529519499996, 247.06823615599995, 261.0545889248, 272.64367113984, 266.71493691187203, 278.77194952949765, 242.2175596235981, 213.7740476988785, 207.4192381591028, 205.53539052728226, 190.4283124218258, 190.34264993746066, 178.07411994996855, 174.25929595997485, 119.20743676797987, 99.9659494143839, 60.97275953150712, 0.9782076252056982, -34.017433899835446, -59.61394711986836, -103.69115769589469, -108.35292615671577, -79.28234092537261, -38.42587274029809, -40.54069819223847, -68.63255855379077, -66.70604684303262, -99.5648374744261, -143.85186997954088, -180.8814959836327, -221.30519678690615, -228.44415742952495, -261.75532594361994, -291.60426075489596, -316.0834086039168, -329.66672688313344, -341.73338150650676, -298.18670520520544, -259.7493641641644, -272.59949133133154, -213.27959306506523, -133.8236744520522, -111.85893956164175, -107.4871516493134, -22.38972131945072, 42.48822294443943, 85.59057835555154, 126.07246268444123, 146.057970147553, 139.2463761180424, 168.19710089443393, 192.15768071554714, 198.12614457243774, 206.1009156579502, 170.88073252636016, 114.70458602108815, 56.963668816870516, 32.37093505349641, 20.69674804279713, -4.642601565762298, -18.51408125260984, 9.588734997912129, 19.670987998329704, -18.263209601336236, -29.81056768106899, -33.04845414485519, -21.238763315884157, -3.391010652707326, -17.91280852216586]}, "chart2": {"proportion": [0.5381263616557734, 0.48148148148148145, -0.25925925925925924, 0.0391304347826087, 0.30151843817787416, 0.4880694143167028, 0.4924078091106291, 0.693304535637149, 0.7710583153347732, 0.7926565874730022, 0.6817204301075269, 0.7806451612903226, 0.7333333333333333, 0.6989247311827957, 0.575107296137339, 0.4592274678111588, 0.5032119914346895, 0.3233404710920771, 0.45610278372591007, 0.4132762312633833, 0.37901498929336186, -0.008547008547008548, -0.3034188034188034, 0.04700854700854701, 0.5276595744680851, 0.4692144373673036, 0.3036093418259023, 0.5423728813559322, 0.2584745762711864, 0.2642706131078224, 0.38105263157894737, 0.3025210084033613, -0.2857142857142857, 0.7100840336134454, 0.773109243697479, 0.7184873949579832, 0.7478991596638656, 0.6645702306079665, 0.6687631027253669, 0.5094339622641509, 0.6855345911949685, 0.200836820083682, 0.20833333333333334, 0.37916666666666665, 0.4125, 0.2697095435684647, 0.3941908713692946, 0.2670807453416149, 0.32919254658385094, -0.20910973084886128, 0.047619047619047616, -0.19668737060041408, -0.4927835051546392, -0.35802469135802467, -0.3333333333333333, -0.5714285714285714, -0.25865580448065173, 0.07535641547861507, 0.2545824847250509, -0.09939148073022312, -0.3656565656565657, -0.1191919191919192, -0.4666666666666667, -0.6484848484848484, -0.6646464646464646, -0.7737373737373737, -0.5191919191919192, -0.797979797979798, -0.8303030303030303, -0.8346774193548387, -0.7741935483870968, -0.7862903225806451, -0.25, -0.21370967741935484, -0.6532258064516129, 0.04838709677419355, 0.3709677419354839, -0.04838709677419355, -0.1814516129032258, 0.6411290322580645, 0.6088709677419355, 0.5201612903225806, 0.5806451612903226, 0.45564516129032256, 0.22580645161290322, 0.5725806451612904, 0.5806451612903226, 0.4475806451612903, 0.4798387096774194, 0.06048387096774194, -0.2217741935483871, -0.35080645161290325, -0.13306451612903225, -0.05241935483870968, -0.21370967741935484, -0.14919354838709678, 0.24596774193548387, 0.12096774193548387, -0.34274193548387094, -0.1532258064516129, -0.09274193548387097, 0.05241935483870968, 0.13709677419354838, -0.1532258064516129], "e9_proportion": [0.5381263616557734, 0.526797385620915, 0.3695860566448802, 0.3034949322724259, 0.30309963345351554, 0.340093589626153, 0.37055643352304823, 0.43510605394586843, 0.5022965062236494, 0.56036852247352, 0.5846389040003214, 0.6238401554583216, 0.645738791033324, 0.6563759790632183, 0.6401222424780424, 0.6039432875446658, 0.5837970283226706, 0.5317057168765519, 0.5165851302464235, 0.4959233504498155, 0.47254167821852483, 0.3763239408654182, 0.24037539200857388, 0.20170202300856852, 0.26689353330047183, 0.30735771411383817, 0.306608039656251, 0.35376100799618726, 0.3347037216511871, 0.3206170999425142, 0.3327042062698008, 0.3266675666965129, 0.2041911962143532, 0.3053697636941717, 0.39891765969483317, 0.46283160674746326, 0.5198451173307438, 0.5487901399861883, 0.5727847325340241, 0.5601145784800494, 0.5851985810230332, 0.508326228835163, 0.4483276497347971, 0.434495453121171, 0.43009636249693683, 0.39801899871124247, 0.3972533732428529, 0.3712188476626053, 0.3628135874468545, 0.24842892378771136, 0.20826694855397862, 0.1272760847231001, 0.0032641667475522412, -0.06899360487356315, -0.12186155056551719, -0.21177495473812802, -0.22115112468663278, -0.16184961665358324, -0.07856319637785641, -0.08272885324832976, -0.13931439572997695, -0.13528990042236538, -0.20156525367122563, -0.2909491726339502, -0.3656886310364531, -0.44729837957663726, -0.46167708749969366, -0.5289376295957146, -0.5892107097371777, -0.6383040516607099, -0.6654819510059873, -0.6896436253209188, -0.6017149002567351, -0.5241138556892591, -0.5499362458417298, -0.43027157731854515, -0.27002371346773935, -0.2256963901290302, -0.21684743468386933, -0.04525214129548255, 0.08557248051200106, 0.17249024247411698, 0.2541212262373581, 0.29442601324795104, 0.2807021009209415, 0.33907780976901125, 0.38739128007327356, 0.39942915309087695, 0.4155110644081854, 0.34450562572009674, 0.23124966186639995, 0.1148384391705393, 0.065257848110625, 0.04172240752075807, -0.009364009467264511, -0.03732991725123097, 0.019329614586111998, 0.03965724005598638, -0.03682259505198508, -0.06010323733191065, -0.06663097696230272, -0.04282091060210024, -0.006837373642970518, -0.036115060204699]}, "chart3": {"abvEMA": [353, 340, 170, 239, 300, 343, 344, 392, 410, 415, 391, 414, 403, 395, 367, 340, 351, 309, 340, 330, 322, 232, 163, 245, 359, 346, 307, 364, 297, 299, 328, 310, 170, 407, 422, 409, 416, 397, 398, 360, 402, 287, 290, 331, 339, 306, 336, 306, 321, 191, 253, 194, 123, 156, 162, 105, 182, 264, 308, 222, 157, 218, 132, 87, 83, 56, 119, 50, 42, 41, 56, 53, 186, 195, 86, 260, 340, 236, 203, 407, 399, 377, 392, 361, 304, 390, 392, 359, 367, 263, 193, 161, 215, 235, 195, 211, 309, 278, 163, 210, 225, 261, 282, 210], "belEMA": [106, 119, 289, 221, 161, 118, 117, 71, 53, 48, 74, 51, 62, 70, 99, 126, 116, 158, 127, 137, 145, 236, 305, 223, 111, 125, 164, 108, 175, 174, 147, 166, 306, 69, 54, 67, 60, 80, 79, 117, 75, 191, 190, 149, 141, 176, 146, 177, 162, 292, 230, 289, 362, 330, 324, 385, 309, 227, 183, 271, 338, 277, 363, 408, 412, 439, 376, 445, 453, 455, 440, 443, 310, 301, 410, 236, 156, 260, 293, 89, 97, 119, 104, 135, 192, 106, 104, 137, 129, 233, 303, 335, 281, 261, 301, 285, 187, 218, 333, 286, 271, 235, 214, 286], "e9AbvEMA": [353.0, 350.40000000000003, 314.32000000000005, 299.25600000000003, 299.4048, 308.12384000000003, 315.299072, 330.63925760000006, 346.5114060800001, 360.2091248640001, 366.3672998912001, 375.8938399129601, 381.3150719303681, 384.0520575442945, 380.64164603543566, 372.51331682834854, 368.2106534626788, 356.36852277014304, 353.09481821611445, 348.4758545728916, 343.18068365831334, 320.9445469266507, 289.35563754132056, 280.4845100330565, 296.1876080264452, 306.1500864211562, 306.320069136925, 317.85605530954, 313.684844247632, 310.7478753981056, 314.1983003184845, 313.3586402547876, 284.68691220383005, 309.14952976306404, 331.71962381045125, 347.175699048361, 360.9405592386888, 368.1524473909511, 374.12195791276093, 371.2975663302088, 377.4380530641671, 359.3504424513337, 345.480353961067, 342.58428316885363, 341.8674265350829, 334.69394122806636, 334.9551529824531, 329.1641223859625, 327.53129790877, 300.225038327016, 290.78003066161284, 271.4240245292903, 241.73921962343226, 224.59137569874582, 212.07310055899669, 190.65848044719735, 188.9267843577579, 203.94142748620632, 224.75314198896507, 224.20251359117208, 210.76201087293768, 212.20960869835014, 196.16768695868012, 174.33414956694412, 156.0673196535553, 136.05385572284425, 132.64308457827542, 116.11446766262034, 101.29157413009628, 89.23325930407704, 82.58660744326164, 76.66928595460931, 98.53542876368745, 117.82834301094996, 111.46267440875998, 141.170139527008, 180.93611162160641, 191.94888929728512, 194.1591114378281, 236.7272891502625, 269.18183132021, 290.745465056168, 310.9963720449344, 320.9970976359475, 317.59767810875803, 332.0781424870064, 344.0625139896051, 347.0500111916841, 351.0400089533473, 333.43200716267785, 305.3456057301423, 276.47648458411385, 264.18118766729106, 258.34495013383287, 245.67596010706632, 238.7407680856531, 252.7926144685225, 257.834091574818, 238.8672732598544, 233.09381860788352, 231.47505488630682, 237.38004390904547, 246.3040351272364, 239.04322810178914], "netStocks": [459, 459, 459, 460, 461, 461, 461, 463, 463, 463, 465, 465, 465, 465, 466, 466, 467, 467, 467, 467, 467, 468, 468, 468, 470, 471, 471, 472, 472, 473, 475, 476, 476, 476, 476, 476, 476, 477, 477, 477, 477, 478, 480, 480, 480, 482, 482, 483, 483, 483, 483, 483, 485, 486, 486, 490, 491, 491, 491, 493, 495, 495, 495, 495, 495, 495, 495, 495, 495, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496, 496]}};
    </script>
    <script>
        
        (function() {
            const chartInstances = {};
            let isSyncing = false;

            document.querySelectorAll('.reset-zoom-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const chartId = e.target.getAttribute('data-chart-id');
                    if (chartInstances[chartId]) {
                        chartInstances[chartId].resetZoom();
                    }
                });
            });

            function syncCharts(sourceChart) {
                if (isSyncing) return;
                isSyncing = true;
                const { min, max } = sourceChart.scales.x;
                for (const chartId in chartInstances) {
                    const targetChart = chartInstances[chartId];
                    if (targetChart.canvas.id !== sourceChart.canvas.id) {
                        targetChart.options.scales.x.min = min;
                        targetChart.options.scales.x.max = max;
                        targetChart.update('none');
                    }
                }
                isSyncing = false;
            }

            function createCharts(data) {
                const computedStyles = getComputedStyle(document.body);
                const colors = {
                    green: computedStyles.getPropertyValue('--green').trim(), red: computedStyles.getPropertyValue('--red').trim(),
                    blue: computedStyles.getPropertyValue('--blue').trim(), cyan: computedStyles.getPropertyValue('--cyan').trim(),
                    yellow: computedStyles.getPropertyValue('--yellow').trim(), magenta: computedStyles.getPropertyValue('--magenta').trim(),
                    text: computedStyles.getPropertyValue('--text-color').trim(), grid: computedStyles.getPropertyValue('--border-color').trim() + '80',
                };
                const commonOptions = {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        x: { grid: { color: colors.grid }, ticks: { color: colors.text, maxRotation: 0, autoSkip: true, maxTicksLimit: 15 }, grace: '5%' },
                        y: { grid: { color: colors.grid }, ticks: { color: colors.text } }
                    },
                    plugins: {
                        legend: { labels: { color: colors.text, font: { size: 14 } } },
                        tooltip: {
                            backgroundColor: computedStyles.getPropertyValue('--card-bg-color').trim(),
                            titleFont: { size: 16 }, bodyFont: { size: 14 }, padding: 10,
                            borderColor: colors.grid, borderWidth: 1, titleColor: colors.text, bodyColor: colors.text,
                        },
                        zoom: {
                            pan: { enabled: true, mode: 'x', onPanComplete: ({ chart }) => syncCharts(chart) },
                            zoom: {
                                drag: { enabled: false },
                                wheel: { enabled: true }, 
                                pinch: { enabled: true },
                                mode: 'x',
                                onZoomComplete: ({ chart }) => syncCharts(chart)
                            }
                        }
                    },
                    elements: { point: { radius: 0 } },
                    interaction: { intersect: false, mode: 'index' }
                };
                const chartHeight = 450;
                document.querySelectorAll('.chart-card canvas').forEach(c => c.parentElement.style.height = chartHeight + 'px');
                
                chartInstances.chart1 = new Chart(document.getElementById('chart1'), { type: 'line', data: { labels: data.labels, datasets: [{ label: 'Trend Of Stks', data: data.chart1.trendOfStocks, borderColor: colors.magenta, borderWidth: 2, tension: 0.1 }, { label: 'e9 (EMA)', data: data.chart1.e9_trendOfStocks, borderColor: colors.blue, borderWidth: 2, tension: 0.1 }] }, options: commonOptions });
                chartInstances.chart2 = new Chart(document.getElementById('chart2'), { type: 'line', data: { labels: data.labels, datasets: [{ label: 'Proportion', data: data.chart2.proportion, borderColor: colors.yellow, borderWidth: 2, tension: 0.1 }, { label: 'e9 (EMA)', data: data.chart2.e9_proportion, borderColor: colors.blue, borderWidth: 2, tension: 0.1 }] }, options: commonOptions });
                chartInstances.chart3 = new Chart(document.getElementById('chart3'), { type: 'line', data: { labels: data.labels, datasets: [{ label: 'Stocks Above EMA', data: data.chart3.abvEMA, borderColor: colors.green, borderWidth: 2, tension: 0.1 }, { label: 'Stocks Below EMA', data: data.chart3.belEMA, borderColor: colors.red, borderWidth: 2, tension: 0.1 }, { label: 'Net Stocks', data: data.chart3.netStocks, borderColor: colors.text, borderWidth: 1, tension: 0.1, borderDash: [5, 5] }] }, options: commonOptions });
            }
            createCharts(window.chartData);
        })();
    
    </script>
</body>
</html>